<!DOCTYPE html>
<html lang="en">
    <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Project 03: Heap Management</title>

	<!-- Bootstrap core CSS -->
	<link href="static/css/blugold.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style>
	body {
	    padding: 10px;
	}
	</style>
    </head>
    <body>
	<div class="container">

	    <div class="row">
		<div class="page-header">
		    <ul class="nav nav-pills pull-right">
			
			<li><a href="index.html"><i class="fa fa-desktop"></i> <span class="visible-md-inline visible-lg-inline">Home</span></a></li>
			
		    </ul>
		    <h1><i class="fa fa-book"></i> Project 03: Heap Management</h1>
		</div>
	    </div>

            
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The third project is to build your own implementation of <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>.  That is, you will need to implement a library that interacts with
the operating system to perform heap management on behalf of a user process
as demonstrated in class.</p>
<div class="thumbnail text-center">
<img src="static/img/project03-heap-management.png">
</div>

<p>As demonstrated in <a href="https://github.com/nd-cse-30341-fa24/examples/blob/master/lecture14/malloc0.c">malloc0.c</a> from <a href="https://docs.google.com/presentation/d/1dnkt6y3w1HsA0f747OEwe1sWlpA0zp2iFmuNHywZCto/edit?usp=sharing">Lecture 14</a>, writing a functional heap
management system is relatively straightforward:</p>
<blockquote>
<p>Simply grow the heap using the <a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a> system call whenever the user
requests memory at run-time.</p>
</blockquote>
<p>Unfortunately, this initial version of a heap manager has some serious problems:</p>
<ol>
<li>
<p>It doesn't actually free anything, so it is quite possible (and likely)
that we would eventually run out of memory.</p>
</li>
<li>
<p>It doesn't keep track of blocks that have been allocated but are no
longer in-use (ie. <strong>free</strong>), so it will never re-use a previous
allocation.  This is both wasteful (as there is memory that we could use,
but don't), and it is slow because we are then forced to call <a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a>, which
is a system call and thus incurs the overhead of <em>context switching</em>.</p>
</li>
</ol>
<p>To remedy this, we wrote <a href="https://github.com/nd-cse-30341-fa24/examples/blob/master/lecture14/malloc1.c">malloc1.c</a>, which utilizes a circular
doubly-linked <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to keep track of <strong>only</strong> the <strong>free</strong> blocks as
shown below:</p>
<div class="thumbnail text-center">
<img src="static/img/project03-circular-free-list.png">
</div>

<p>The <a href="https://github.com/nd-cse-30341-fa24/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> shown in class has the following features:</p>
<ol>
<li>
<p>It maintains a <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> of all the <strong>free</strong> blocks (previously
allocated blocks that are no longer in use).</p>
</li>
<li>
<p><a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> will search this <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> for a <strong>free</strong> block it can
re-use.  If no such block exists, it will simply fall-back to growing the
heap with <a href="http://man7.org/linux/man-pages/man2/brk.2.html">sbrk</a>.</p>
</li>
<li>
<p><a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> will insert released blocks to the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to make them
available for future re-use.</p>
</li>
</ol>
<p>While this second version is better than the first heap manager, it is
still lacking important features.  For this project, you are to extend the
functionality of the <a href="https://github.com/nd-cse-30341-fa24/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> allocator to incorporate the following:</p>
<ol>
<li>
<p>Ensure that all memory allocations are aligned to the nearest <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a>.</p>
</li>
<li>
<p>Implement multiple <strong>search</strong> algorithms (<strong>First Fit</strong>, <strong>Best Fit</strong>,
and <strong>Worst Fit</strong>).</p>
<p><em>To support different strategies in the same source file, we will use
<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a>'s <a href="https://msdn.microsoft.com/en-us/library/ew2hz0yd.aspx">#if</a> directive to select different blocks of code at compile
time.</em></p>
</li>
<li>
<p>Implement <strong>shrinking</strong> the heap when a block is released.</p>
</li>
<li>
<p>Implement <strong>splitting</strong> a block when it is re-used.</p>
</li>
<li>
<p>Implement <strong>merging</strong> a block when it is inserted into the <strong>free list</strong>.</p>
</li>
<li>
<p>Ensure that blocks in the <strong>free list</strong> are stored in sorted (ie.
<strong>ascending</strong>) order.</p>
</li>
<li>
<p>Implement the complementary <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a> and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a> functions.</p>
</li>
<li>
<p>Add counters to keep track of number of operations performed by the
allocator and the amount of <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#Internal_fragmentation">internal fragmentation</a> and <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#External_fragmentation">external
fragmentation</a>.  When the process exits, the library should output the
following type of information (based on the counters):</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>blocks:      0
free blocks: 0
mallocs:     10
frees:       10
callocs:     0
reallocs:    0
reuses:      0
grows:       10
shrinks:     10
splits:      0
merges:      0
requested:   10240
heap size:   0
internal:    0.00
external:    0.00
</code></pre></div>

</li>
</ol>
<p>Once you have a working <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> implementation (as verified by the
provided functional and unit tests), you are to analyze the metrics above
for the different heap management strategies.</p>
<div class="alert alert-danger">
<p><strong>Note</strong>: We will not consider thread-safety or support multiple threads at
all for this project.</p>
</div>
<p>Working in groups of <strong>one</strong> or <strong>two</strong> people, you are to create a
<strong>library</strong> that implements <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> by <strong>noon</strong> on <strong>Monday,
November 18, 2024</strong>.  More details about this project and your deliverables
are described below.</p>
<div class="alert alert-info">
<h4 id="heap-management"><i class="fa fa-cogs"></i> Heap Management<a class="headerlink" href="#heap-management" title="Permanent link">&para;</a></h4>
<p>Implementing your own heap management library is more common than you
think.  For instance, <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a> uses <a href="http://jemalloc.net/">jemalloc</a>, while <a href="https://www.gnu.org">GNU</a> uses
<a href="http://gee.cs.oswego.edu/dl/html/malloc.html">dlmalloc</a>, and <a href="https://www.google.com">Google</a> provides <a href="http://goog-perftools.sourceforge.net/doc/tcmalloc.html">tcmalloc</a>.  As hardware and operating
systems evolve, the optimal <strong>heap management strategies</strong> change as well,
and so developers continue to advance the state of the art.  For this
project, we will focus on understanding the basics and getting something
that works (<em>good enough</em>).</p>
<p>For a reference on how to create a simple heap management library, I
recommend: <a href="http://danluu.com/malloc-tutorial/">A quick tutorial on implementing and debugging malloc, free,
calloc, and realloc</a>.  This is what I
initially used as the basis for this project (<em>many moons ago</em>).</p>
</div>
<h2 id="deliverables">Deliverables<a class="headerlink" href="#deliverables" title="Permanent link">&para;</a></h2>
<p>As noted above, you are to work <strong>individually</strong> or in <strong>pairs</strong> to
implement your heap management library.  You must use <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> (not <a href="https://isocpp.org/">C++</a>) as
the implementation language.  Any test scripts or auxillary tools can be
written in any reasonable scripting language.</p>
<h3 id="timeline">Timeline<a class="headerlink" href="#timeline" title="Permanent link">&para;</a></h3>
<p>Here is a timeline of events related to this project:</p>
<table class="table table-striped table-bordered">
<thead>
<th>Date</th>
<th>Event</th>
</thead>
<tbody>
<tr>
<td class="text-strong">Sunday, October 27</td>
<td>Project description and repository are available.</td>
</tr>
<tr>
<td class="text-strong">Sunday, November 10</td>
<td>Brainstorming should be completed.</td>
</tr>
<tr>
<td class="text-strong">Monday, November 18</td>
<td>Library is due (pushed to <a href="https://github.com">GitHub</a> <code>project03</code> branch).</td>
</tr>
</tbody>
</table>
<div class="alert alert-success">
<h4 id="group-project"><i class="fa fa-github"></i> Group Project<a class="headerlink" href="#group-project" title="Permanent link">&para;</a></h4>
<p>For the final submission, please open a <strong>Pull Request</strong> on your repository
(for your <code>project03</code> branch to the <code>master</code> branch) and assign it to the
<strong>instructor</strong>.</p>
</div>
<h3 id="repository">Repository<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h3>
<p>To start this project, you must create a <a href="https://github.com/nd-cse-30341-fa24/project03">Project 03</a> repository on <a href="https://github.com">GitHub</a>
using the following template:</p>
<blockquote>
<p><a href="https://classroom.github.com/a/tSiXMZj7">https://classroom.github.com/a/tSiXMZj7</a></p>
</blockquote>
<div class="alert alert-warning">
<p><strong>Note</strong>: Do your work in a separate <a href="https://git-scm.com/">git</a> branch that can be later merged
into the <code>master</code> branch (ie. make a <code>project03</code> branch, <strong>DO NOT COMMIT OR
MERGE TO MASTER</strong>).</p>
</div>
<h3 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/nd-cse-30341-fa24/project03">Project 03</a> repository includes a <code>README.md</code> file with the following
sections:</p>
<ol>
<li>
<p><strong>Student</strong>: This should be the names and email addresses of each group member.</p>
</li>
<li>
<p><strong>Video</strong>: This should have the link to your reflection video (described below).</p>
</li>
<li>
<p><strong>Brainstorming</strong>: This contains questions that should help you design
  and plan your approach to the project. <strong>You do not need to fill these
  out, but they are meant to be helpful</strong>.</p>
</li>
<li>
<p><strong>Errata</strong>: This should contain a description of any known errors or
deficiencies in your implementation.</p>
</li>
<li>
<p><strong>Acknowledgments</strong>: This should list anyone you collaborated with or
  received help from (including TAs, students, and AI tools).</p>
</li>
</ol>
<p>You must complete this document report as part of your project.</p>
<h3 id="source-code">Source Code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h3>
<p>As you can see, the base <a href="https://github.com/nd-cse-30341-fa24/project03">Project 03</a> repository contains a <code>README.md</code>
file and the following folder hierarchy:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>project03
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>Makefile<span style="color: #bbbbbb">        </span><span style="color: #3D7B7B; font-style: italic"># This is the project Makefile</span>
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>bin<span style="color: #bbbbbb">             </span><span style="color: #3D7B7B; font-style: italic"># This contains the binary executables and test scripts</span>
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>include
<span style="color: #bbbbbb">        </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>malloc<span style="color: #bbbbbb">      </span><span style="color: #3D7B7B; font-style: italic"># This contains the malloc library header files</span>
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>lib<span style="color: #bbbbbb">             </span><span style="color: #3D7B7B; font-style: italic"># This contains the malloc library when built</span>
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>src<span style="color: #bbbbbb">             </span><span style="color: #3D7B7B; font-style: italic"># This contains the malloc library source code</span>
<span style="color: #bbbbbb">    </span><span style="color: #AA5D1F; font-weight: bold">\_</span><span style="color: #bbbbbb">  </span>tests<span style="color: #bbbbbb">           </span><span style="color: #3D7B7B; font-style: italic"># This contains the functional and unit test code</span>
</code></pre></div>

<p>You must maintain this folder structure for your project and place files in
their appropriate place.</p>
<h4 id="compiling">Compiling<a class="headerlink" href="#compiling" title="Permanent link">&para;</a></h4>
<p>To help you get started, we have provided a <code>Makefile</code> with all the
necessary targets:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #bbbbbb"> </span>make<span style="color: #bbbbbb">                  </span><span style="color: #3D7B7B; font-style: italic"># Build libraries and test applications</span>
Building<span style="color: #bbbbbb"> </span>lib/libmalloc-ff.so
Building<span style="color: #bbbbbb"> </span>lib/libmalloc-bf.so
Building<span style="color: #bbbbbb"> </span>lib/libmalloc-wf.so
Building<span style="color: #bbbbbb"> </span>bin/test_00
Building<span style="color: #bbbbbb"> </span>bin/test_01
Building<span style="color: #bbbbbb"> </span>bin/test_02
Building<span style="color: #bbbbbb"> </span>bin/test_03
Building<span style="color: #bbbbbb"> </span>bin/test_04
Building<span style="color: #bbbbbb"> </span>bin/test_05
Building<span style="color: #bbbbbb"> </span>bin/unit_block
Building<span style="color: #bbbbbb"> </span>bin/unit_freelist

$<span style="color: #bbbbbb"> </span>make<span style="color: #bbbbbb"> </span>clean<span style="color: #bbbbbb">            </span><span style="color: #3D7B7B; font-style: italic"># Removes all targets</span>
Removing<span style="color: #bbbbbb"> </span>libraries
Removing<span style="color: #bbbbbb"> </span>tests
</code></pre></div>

<div class="alert alert-warning">
<h4 id="kiss"><i class="fa fa-code"></i> K.I.S.S.<a class="headerlink" href="#kiss" title="Permanent link">&para;</a></h4>
<p>While the exact organization of the project code is up to you, keep in mind
that you will be graded in part on <strong>coding style</strong>, <strong>cleaniness</strong>, and
<strong>organization</strong>.  This means your code should be consistently formatted,
not contain any dead code, have reasonable comments, and appropriate naming
among other things:</p>
<ul>
<li>
<p>Break long functions into smaller functions.</p>
</li>
<li>
<p>Make sure each function does one thing and does it well.</p>
</li>
<li>
<p>Abstract, but don't over do it.</p>
</li>
</ul>
<p>Please refer to these <a href="static/img/coding-style.png">Coding Style</a> slides for some tips and guidelines on
coding style expectations.</p>
</div>
<h4 id="running">Running<a class="headerlink" href="#running" title="Permanent link">&para;</a></h4>
<p>Once you have the library, you can use it to override the existing <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
functions from the standard library by using the <code>LD_PRELOAD</code> trick:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># Use our implementation of library</span>
$<span style="color: #bbbbbb"> </span>env<span style="color: #bbbbbb"> </span><span style="color: #19177C">LD_PRELOAD</span><span style="color: #666666">=</span>lib/libmalloc-ff.so<span style="color: #bbbbbb"> </span>cat<span style="color: #bbbbbb"> </span>README.md
</code></pre></div>

<p>This will load our library first and thus link any calls to <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> and
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a> in <code>cat</code> to our library rather than the standard <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> library.  To
make this more convenient, you should consider creating a <code>bin/run.sh</code>
script that sets the environment variable for you and then runs the
specified command.</p>
<div class="alert alert-info">
<p><strong>Note</strong>: there are three versions of our custom <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> implementation,
where each version corresponds to a different <strong>search</strong> algorithm (<strong>first
fit (ff)</strong>, <strong>best fit (bf)</strong>, and <strong>worst fit (wf)</strong>).</p>
</div>
<h4 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h4>
<p>All of the <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> header files are in the <code>include/malloc</code> folder, while the
<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> source code for the <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> library is in the <code>src</code> folder.  To help
you get started, parts of the project are already implemented:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #666666">[</span>x<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>include/malloc/block.h<span style="color: #bbbbbb">      </span><span style="color: #3D7B7B; font-style: italic"># Block structure header (implemented)</span>
<span style="color: #666666">[</span>x<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>include/malloc/counters.h<span style="color: #bbbbbb">   </span><span style="color: #3D7B7B; font-style: italic"># Counters header (implemented)</span>
<span style="color: #666666">[</span>x<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>include/malloc/freelist.h<span style="color: #bbbbbb">   </span><span style="color: #3D7B7B; font-style: italic"># Free List header (implemented)</span>
<span style="color: #666666">[</span>~<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>src/block.c<span style="color: #bbbbbb">                 </span><span style="color: #3D7B7B; font-style: italic"># Block structure definitions (partially implemented)</span>
<span style="color: #666666">[</span>~<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>src/counters.c<span style="color: #bbbbbb">              </span><span style="color: #3D7B7B; font-style: italic"># Counters definitions (partially implemented)</span>
<span style="color: #666666">[</span>~<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>src/freelist.c<span style="color: #bbbbbb">              </span><span style="color: #3D7B7B; font-style: italic"># Free List definitions (partially implemented)</span>
<span style="color: #666666">[</span>~<span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>src/posix.c<span style="color: #bbbbbb">                 </span><span style="color: #3D7B7B; font-style: italic"># POSIX definitions (partially implemented)</span>
</code></pre></div>

<p>Basically, the <a href="https://github.com/nd-cse-30341-fa24/examples/blob/master/lecture14/malloc1.c">malloc1.c</a> code demonstrated in <a href="https://docs.google.com/presentation/d/1dnkt6y3w1HsA0f747OEwe1sWlpA0zp2iFmuNHywZCto/edit?usp=sharing">Lecture 14</a> was taken and
split into separate files to form the skeleton provided to you.
Additionally, we have implemented most of the desired counting
functionality for you, so you can concentrate on just the block
manipulation and free list management operations.  Each of the functions in
the incomplete files above have comments that describe what needs to be
done.</p>
<p>You will need to examine these source files and complete the implementation
of a <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a> library that uses a <strong>circular doubly-linked</strong> <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> to
track <strong>free</strong> blocks in sorted order (ie. smaller block addresses appear
towards the front of the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a>).  To do so, you should start with the
basic <code>Block</code> functions, then move to the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> functions.  Once
those pass the provided unit tests, you should then utilize those
components to complete the <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a>, and <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a>
functions:</p>
<ol>
<li>
<p><code>src/block.c</code>: This file contains the functions for the <code>Block</code>
structure, which contains the <strong>aligned</strong> <code>capacity</code> of the requested
allocation and the <strong>unaligned</strong> <code>size</code> of the requested allocation
(neither of which includes space for the embedded <code>Block</code> structure), and
pointers to the previous and next <code>Block</code> structures.  If the <code>Block</code> is
detached, then it should just point to itself.</p>
<p>You will need to think carefully about how to manipulate the <code>Block</code>
structure in the context of circular doubly-linked list with a sentinel
node.</p>
</li>
<li>
<p><code>src/counters.c</code>: This file contains the functions for keeping
track of the various counters utilized in the library.  Whenever <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
is called, it will call the <code>init_counters</code> function which will register
the <code>dump_counters</code> function to run when the program properly terminates.</p>
<p>You will need to implement the functions for computing the <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#Internal_fragmentation">internal
fragmentation</a> and <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)#External_fragmentation">external fragmentation</a> of the heap.</p>
</li>
<li>
<p><code>src/freelist.c</code>: This file contains the functions for the <a href="https://en.wikipedia.org/wiki/Free_list">free
list</a>.</p>
<p>You will need to think carefully about what needs to happen during
searching and insertion.  In particular, you will need to think about
how to ensure the <a href="https://en.wikipedia.org/wiki/Free_list">free list</a> remains in sorted order and then how to
exploit that ordering to <strong>merge</strong> adjacent blocks.</p>
</li>
<li>
<p><code>src/posix.c</code>: This file contains the <a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a> functions: <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>,
<a href="http://man7.org/linux/man-pages/man3/malloc.3.html">free</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">calloc</a>, <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">realloc</a>.</p>
<p>You will need to think carefully about which of the previous functions
you want to utilize.</p>
</li>
</ol>
<div class="alert alert-info">
<p><strong>Note</strong>: There are also some <code>TODOs</code> to help identify which parts you need
to implement, along with how you will want to modify the counters.</p>
</div>
<div class="alert alert-success">
<h4 id="alignment"><i class="fa fa-align-right"></i> Alignment<a class="headerlink" href="#alignment" title="Permanent link">&para;</a></h4>
<p>For better performance, all memory allocations should be aligned by the
<a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> of the current machine.  For instance, if the user requests
<code>14</code> bytes and our <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> is <code>8</code> bytes, then we will actually allocate
<code>16</code> bytes as this is the nearest multiple of the <a href="https://en.wikipedia.org/wiki/Word_(computer_architecture)">word size</a> (that has
sufficient capacity).</p>
<p>A <code>ALIGN</code> macro is provided to you that will perform this <em>rounding</em>
automatically for you.  Whenever you are comparing or determining
<strong>sizes</strong>, you need to think carefully if you want to use the original size
as requested by the user and stored in the <code>Block</code> structure (e.g. <code>14</code>) or
if you really want to use the capacity of the Block (e.g.
<code>block-&gt;capacity</code>) which stores the original <strong>aligned</strong> allocation
capacity.</p>
<p>Failure to properly utilize this <code>ALIGN</code> macro will most likely lead to
<strong>subtle</strong> and <strong>frustrating</strong> errors.</p>
</div>
<h3 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h3>
<p>As you develop your library, you should utilize the provided functional and
unit tests that ensure your heap management library works correctly:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$ make test             # Build and runs test programs
Building bin/test_00
Building bin/test_01
Building bin/test_02
Building bin/test_03
Building bin/test_04
Building bin/test_05
Building bin/unit_block
Building bin/unit_freelist

Testing unit_block...
  block_allocate                         ... Success
  block_release                          ... Success
  block_detach                           ... Success
  block_merge                            ... Success
  block_split                            ... Success

Testing unit_freelist...
  free_list_search_ff                    ... Success
  free_list_search_bf                    ... Success
  free_list_search_wf                    ... Success
  free_list_insert                       ... Success
  free_list_length                       ... Success

Building lib/libmalloc-ff.so
Building lib/libmalloc-bf.so
Building lib/libmalloc-wf.so
Running run_test_00.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_01.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_02.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_03.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_04.sh
  Testing libmalloc-ff.so                ... Success
  Testing libmalloc-bf.so                ... Success
  Testing libmalloc-wf.so                ... Success

Running run_test_05.sh
  Timing libmalloc-ff.so                 ... 0m1.636s
  Timing libmalloc-bf.so                 ... 0m2.959s
  Timing libmalloc-wf.so                 ... 0m2.976s

Running run_test_06.sh
  Testing libmalloc-ff.so (cat)          ... Success
  Testing libmalloc-bf.so (cat)          ... Success
  Testing libmalloc-wf.so (cat)          ... Success
  Testing libmalloc-ff.so (md5sum)       ... Success
  Testing libmalloc-bf.so (md5sum)       ... Success
  Testing libmalloc-wf.so (md5sum)       ... Success
  Testing libmalloc-ff.so (sha1sum)      ... Success
  Testing libmalloc-bf.so (sha1sum)      ... Success
  Testing libmalloc-wf.so (sha1sum)      ... Success
  Testing libmalloc-ff.so (sort)         ... Success
  Testing libmalloc-bf.so (sort)         ... Success
  Testing libmalloc-wf.so (sort)         ... Success
  Testing libmalloc-ff.so (dd)           ... Success
  Testing libmalloc-bf.so (dd)           ... Success
  Testing libmalloc-wf.so (dd)           ... Success
  Testing libmalloc-ff.so (du)           ... Success
  Testing libmalloc-bf.so (du)           ... Success
  Testing libmalloc-wf.so (du)           ... Success
  Testing libmalloc-ff.so (find)         ... Success
  Testing libmalloc-bf.so (find)         ... Success
  Testing libmalloc-wf.so (find)         ... Success
</code></pre></div>

<p>Note, you can run tests individually:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #bbbbbb"> </span>./bin/run_test_00.sh
<span style="color: #bbbbbb">  </span>Testing<span style="color: #bbbbbb"> </span>libmalloc-ff.so<span style="color: #bbbbbb">                </span>...<span style="color: #bbbbbb"> </span>Success
<span style="color: #bbbbbb">  </span>Testing<span style="color: #bbbbbb"> </span>libmalloc-bf.so<span style="color: #bbbbbb">                </span>...<span style="color: #bbbbbb"> </span>Success
<span style="color: #bbbbbb">  </span>Testing<span style="color: #bbbbbb"> </span>libmalloc-wf.so<span style="color: #bbbbbb">                </span>...<span style="color: #bbbbbb"> </span>Success
</code></pre></div>

<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>While running the tests, you may encounter some <strong>segfaults</strong> and other
memory errors.  Because we are side-loading our own <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
implementation, you will need to do the following to debug a test
application using <a href="https://www.gnu.org/software/gdb/">gdb</a>.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #bbbbbb"> </span>gdb<span style="color: #bbbbbb"> </span>./bin/test_01
...
<span style="color: #666666">(</span>gdb<span style="color: #666666">)</span><span style="color: #bbbbbb"> </span><span style="color: #008000">set</span><span style="color: #bbbbbb"> </span>exec-wrapper<span style="color: #bbbbbb"> </span>env<span style="color: #bbbbbb"> </span><span style="color: #19177C">LD_PRELOAD</span><span style="color: #666666">=</span>./lib/libmalloc-ff.so
<span style="color: #666666">(</span>gdb<span style="color: #666666">)</span><span style="color: #bbbbbb"> </span>run
...
<span style="color: #666666">(</span>gdb<span style="color: #666666">)</span><span style="color: #bbbbbb"> </span>bt
</code></pre></div>

<p>Basically, you want to first load <a href="https://www.gnu.org/software/gdb/">gdb</a> with the test program that is
crashing.  Next, you need to tell <a href="https://www.gnu.org/software/gdb/">gdb</a> to utilize the appropriate <a href="http://man7.org/linux/man-pages/man3/malloc.3.html">malloc</a>
library by creating an <code>exec-wrapper</code> that loads it into memory.  Next,
simply run the program.  Once it segfaults, you can print a stack trace by
using the <code>bt</code> command.  From there, you can explore the state of your
program and see if you can determine what went wrong.</p>
<h2 id="reflection">Reflection<a class="headerlink" href="#reflection" title="Permanent link">&para;</a></h2>
<p>To reflect on the project and the concepts involved, you will need to
create a <strong>group video demonstration</strong> of your software artifact and
complete an <strong>individual quiz</strong> (<em>each member will submit their own answers
to their own private assignments repository</em>).</p>
<h3 id="video-demonstration">Video Demonstration<a class="headerlink" href="#video-demonstration" title="Permanent link">&para;</a></h3>
<p>As part of your grade, your group will need to create a video that
demonstrates and discusses the following:</p>
<ol>
<li>
<p>Your <strong>library</strong> passing the automated tests.</p>
</li>
<li>
<p>Compares and contrast the three heap management strategies by discussing:</p>
<p>a. Which heap management strategy uses the <strong>least amount of space</strong>?</p>
<p>b. Which heap management strategy was the <strong>fastest</strong>?</p>
<p>c. Which heap management strategy exhibited the <strong>least fragmentation</strong>?</p>
</li>
<li>
<p>Any <strong>errata, quirks, or unresolved issues</strong> in your project.</p>
</li>
<li>
<p>What you <strong>learned</strong> by doing this project.</p>
</li>
</ol>
<p>The video should include narration to describe what is being presented and
should cover the requirements enumerated above. It should be no longer than
<code>5</code> minutes.</p>
<p>Please upload the video to either <a href="https://youtube.com">YouTube</a> or <a href="https://drive.google.com">Google Drive</a> and provide a
link to it in your <code>README.md</code>.</p>
<h3 id="individual-quiz">Individual Quiz<a class="headerlink" href="#individual-quiz" title="Permanent link">&para;</a></h3>
<p>Once you have completed the project, answer the following <a href="static/json/project03.json">Project 03 Quiz</a>
questions <strong>individually</strong> in your own personal <code>assignments</code> repository on <a href="https://github.com">GitHub</a>:</p>
<div id="quiz-questions"></div>

<div id="quiz-responses"></div>

<script src="static/js/dredd-quiz.js"></script>
<script>
loadQuiz('static/json/project03.json');
</script>

<pre style="display: none;" id="dr-container" class="codehilite"><code id="dredd-response"></code></pre>

<p>The results of the quiz should look like the following:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Checking project03 quiz ...
      Q1 0.50
      Q2 0.50
      Q3 2.00
   Score 3.00 / 3.00
  Status Success
</code></pre></div>

<div class="alert alert-info">
<h4 id="individual-quiz_1"><i class="fa fa-git"></i> Individual Quiz<a class="headerlink" href="#individual-quiz_1" title="Permanent link">&para;</a></h4>
<p>Each group member should do the quiz on their own and record their answers
in the <code>project03</code> folder in their <strong>assignments</strong> <a href="https://github.com">GitHub</a> repository.</p>
<p>Once you have committed your work and pushed it to <a href="https://github.com">GitHub</a>, remember to
create a <strong>pull request</strong> and assign it to the appropriate <strong>teaching
assistant</strong> from the <a href="reading09_tas.html">Reading 09 TA List</a>.</p>
</div>
<h2 id="grading">Grading<a class="headerlink" href="#grading" title="Permanent link">&para;</a></h2>
<p>Your project will be graded on the following metrics:</p>
<table class="table table-striped table-bordered">
<thead>
    <th>Metric</th>
    <th>Points</th>
  </thead>
<tbody>
    <tr>
      <td>
        <strong>Source Code</strong>
        <ol>
          <li><b>General</b>
            <ul>
              <li>Builds and cleans without warnings or errors</li>
              <li>Manages resources such as memory and files appropriately</li>
              <li>Is consistent, readable, and organized</li>
              <li>Has regular commits and submitted on-time</li>
            </ul>
          </li>
          <br>
          <li><b>Block</b>
            <ul>
              <li>Implements <tt>block_release</tt> properly</li>
              <li>Implements <tt>block_detach</tt> properly</li>
              <li>Implements <tt>block_merge</tt> properly</li>
              <li>Implements <tt>block_split</tt> properly</li>
            </ul>
          </li>
          <br>
          <li><b>Counters</b>
            <ul>
              <li>Implements <tt>internal_fragmentation</tt> properly</li>
              <li>Implements <tt>external_fragmentation</tt> properly</li>
            </ul>
          </li>
          <br>
          <li><b>Free List</b>
            <ul>
              <li>Implements <tt>free_list_search_ff</tt> properly</li>
              <li>Implements <tt>free_list_search_bf</tt> properly</li>
              <li>Implements <tt>free_list_search_wf</tt> properly</li>
              <li>Implements <tt>free_list_insert</tt> properly</li>
              <li>Implements <tt>free_list_length</tt> properly</li>
            </ul>
          </li>
          <br>
          <li><b>POSIX</b>
            <ul>
              <li>Implements <tt>malloc</tt> properly</li>
              <li>Implements <tt>free</tt> properly</li>
              <li>Implements <tt>calloc</tt> properly</li>
              <li>Implements <tt>realloc</tt> properly</li>
            </ul>
          </li>
        </ol>
      </td>
      <td>
        <strong>10.00</strong>
        <ol class="list-unstyled">
          <li><b><i>1.00</i></b>
            <ul class="list-unstyled">
              <li><i>0.25</i></li>
              <li><i>0.25</i></li>
              <li><i>0.25</i></li>
              <li><i>0.25</i></li>
            </ul>
          </li>
          <br>
          <li><b><i>2.5</i></b>
            <ul class="list-unstyled">
              <li><i>0.25</i></li>
              <li><i>0.25</i></li>
              <li><i>1.00</i></li>
              <li><i>1.00</i></li>
            </ul>
          </li>
          <br>
          <li><b><i>0.50</i></b>
            <ul class="list-unstyled">
              <li><i>0.25</i></li>
              <li><i>0.25</i></li>
            </ul>
          </li>
          <br>
          <li><b><i>3.0</i></b>
            <ul class="list-unstyled">
              <li><i>0.50</i></li>
              <li><i>0.50</i></li>
              <li><i>0.50</i></li>
              <li><i>1.00</i></li>
              <li><i>0.50</i></li>
            </ul>
          </li>
          <br>
          <li><b><i>3.0</i></b>
            <ul class="list-unstyled">
              <li><i>2.0</i></li>
              <li><i>1.0</i></li>
              <li><i>1.0</i></li>
              <li><i>1.0</i></li>
            </ul>
          </li>
        </ol>
      </td>
    </tr>
     <tr>
      <td>
      <strong>Reflection</strong>
      <ol>
        <li><b>Group Video Demonstration</b>
        <ul>
          <li>Exhibits reasonable audio and video quality</li>
          <li>Demonstrates <b>library</b> passing automated tests</li>
          <li>Compares and contrasts <b>heap management strategies</b></li>
          <li>Discusses errata, quirks, or unresolved issues</li>
          <li>Discusses what the group learned from the project</li>
        </ul>
        <br>
        </li>
        <li><b>Individual Quiz</b></li>
      </ol>
      </td>
      <td>
      <strong>5.00</strong>
      <ol class="list-unstyled">
        <li><b><i>2.0</i></b>
        <ul class="list-unstyled">
          <li><i>0.25</i></li>
          <li><i>0.75</i></li>
          <li><i>0.50</i></li>
          <li><i>0.25</i></li>
          <li><i>0.25</i></li>
        </ul>
        <br>
        </li>
        <li><b>3.0</b></li>
      </ol>
    </tr>
  </tbody>
</table>
<div class="alert alert-warning">
<h4 id="commit-history"><i class="fa fa-git"></i> Commit History<a class="headerlink" href="#commit-history" title="Permanent link">&para;</a></h4>
<p>To encourage you to work on the project <strong>regularly</strong> (rather than leaving
it until the last second) and to practice performing <strong>incremental
development</strong>, part of your grade will be based on whether or not you have
regular and reasonably sized commits in your <a href="https://git-scm.com/">git</a> log.</p>
<p>That is, you will <strong>lose</strong> a point if you commit everything at once near
the project deadline.</p>
</div>


	    <div class="row">
		<hr/>

		<footer class="text-center">
		    <p class="text-muted">
		    <small>
		    Built using
		    <a href="https://getbootstrap.com/">Bootstrap</a>,
		    <a href="https://fontawesome.com/">Font Awesome</a>, and
		    <a href="http://www.python.org/">Python</a>.
		    <br/>
		    &copy; 2024 <a href="http://www.nd.edu">University of Notre Dame</a>
		    </small>
		    </p>
		</footer>
	    </div>

	</div> <!-- /container -->

	<!-- Bootstrap core JavaScript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	
	
    </body>
</html>

